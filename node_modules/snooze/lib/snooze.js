var _ = require('lodash');
var _module = require('./module');
var _validator = require('./validator');

var _new = function() {
	var _modules = [];

	var moduleExists = function(nm) {
		var mod = _.find(_modules, function(module) {
			return module.getName() === nm;
		});

		if(mod === undefined) {
			return false;
		}

		return true;
	}

	var getModule = function(nm) {
		return _.find(_modules, function(module) {
			return module.getName() === nm;
		});
	};

	var createModule = function(nm, modules) {
		var module = _module(nm, modules);
		_modules.push(module);
		return module;
	};

	var module = function(nm, modules) {
		if(moduleExists(nm)) {
			var mod = getModule(nm);
			
			if(typeof modules === 'object' && modules.length > 0) {
				mod.addModules(modules);
			}

			return mod;
		} else {
			return createModule(nm, modules);
		}
	};

	return {
		'module': module,
		'moduleExists': moduleExists
	}
}

module.exports = _new();